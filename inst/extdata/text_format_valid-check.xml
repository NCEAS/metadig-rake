<?xml version="1.0" encoding="UTF-8"?>
<mdq:check xmlns:mdq="https://nceas.ucsb.edu/mdqe" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="https://nceas.ucsb.edu/mdqe ../schemas/schema1.xsd">
  <id>check.text.file.format.valid</id>
  <name>Text file is valid</name>
  <description>Check that a text file is formatted as expected.</description>
  <type>identification</type>
  <level>REQUIRED</level>
  <environment>rscript</environment>
  <code><![CDATA[
  library(metadigRake)

  # not sure how to pass the file here, right now this would work if the
  # file was sitting in the same directory the check is running in (and has the
  # same name as in the EML entityName)

  if (textFormatsPresent & file.exists(fileName)){
    status <- check_text_file_format(fileName, fieldDelimiter, headerLines)
  }

  ]]></code>
 <selector>
    <name>textFormatsPresent</name>
    <xpath>boolean(/eml/dataset/*[self::dataTable|self::spatialRaster|self::spatialVector|self::storedProcedure|self::view|self::otherEntity]/physical/dataFormat/textFormat/)
    </xpath>
  </selector>
  <selector>
     <name>fieldDelimiter</name>
     <xpath>
        /eml/dataset/*[self::dataTable|self::spatialRaster|self::spatialVector|self::storedProcedure|self::view|self::otherEntity]
     </xpath>
     <subSelector>
        <name>...</name>
        <xpath>./physical/dataFormat/textFormat/simpleDelimited/fieldDelimiter</xpath>
    </subSelector>
  </selector>
  <selector>
     <name>headerLines</name>
     <xpath>
        /eml/dataset/*[self::dataTable|self::spatialRaster|self::spatialVector|self::storedProcedure|self::view|self::otherEntity]
     </xpath>
     <subSelector>
        <name>...</name>
        <xpath>./physical/dataFormat/textFormat/numHeaderLines</xpath>
    </subSelector>
  </selector>
  <selector>
     <name>fileName</name>
     <xpath>
        /eml/dataset/*[self::dataTable|self::spatialRaster|self::spatialVector|self::storedProcedure|self::view|self::otherEntity]
     </xpath>
     <subSelector>
        <name>...</name>
        <xpath>entityName</xpath>
    </subSelector>
  </selector>
  <selector>
  <dialect>
    <name>eml</name>
    <xpath>boolean(/*[local-name() = 'eml'])</xpath>
  </dialect>
</mdq:check>
